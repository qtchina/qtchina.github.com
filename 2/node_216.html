
<!DOCTYPE HTML>
<html>
<head>
<meta charset='utf8'>
<title>纯手工编译安装 KDE4-svn</title>
</head>
<body>
<ol>
<li>前提：

<p>qt-4.4.0以上</p>

<p>g++</p>

<p>cmake</p>

<p>subversion</p>

<p>确认qmake, g++, cmake, svn 在你的PATH中。</p></li>

<li>安装KDE4桌面必须的基本包：

<p>kdesupport</p>

<p>webkitkde</p>

<p>kdelibs</p>

<p>kdepimlibs</p>

<p>kdebase</p></li>

<li>环境变量：

<p>KDEDIR               kde安装路径</p>

<p>PKG_CONFIG_PATH      .pc文件搜索路径     在这个变量中加上路径：~/kde/lib/pkgconfig/</p>

<p>如：export PKG_CONFIG_PATH=/home/kde/kde/lib/pkgconfig/:$PKG_CONFIG_PATH</p></li>

<li>目录结构：

<p>~/kde/                       安装编译好的KDE4程序及库</p>

<p>~/sources/                   源代码，编译临时文件。</p>

<p>~/sources/src/               源代码，</p>

<p>~/sources/src/kdesupport/</p>

<p>~/sources/src/webkitkde/</p>

<p>~/sources/src/KDE/</p>

<p>~/sources/src/KDE/kdelibs/</p>

<p>~/sources/src/KDE/kdepimlibs/</p>

<p>~/sources/src/KDE/kdebase/</p>

<p>~/sources/src/zh_CN/          这目录存放.po翻译的源文件。可以装成你想要的任何语言。</p>

<p>~/sources/build/              编译临时文件。</p></li>

<li>cmake 命令：

<p>命令参数：</p>

<ul>
<li>DCMAKE_INSTALL_PREFIX=/home/kneworld/kde/   指定安装目录,必须指定绝对路径.必要参数。</li>

<li>DPKGCONFIG_INSTALL_PREFIX=/home/kneworld/kde/lib/pkgconfig/ 。 必要参数。</li>

<li>DCMAKE_VERBOSE_MAKEFILE=on开启makefile详细信息输出功能,可不用。</li>

<li>DCMAKE_BUILD_TYPE=release      是否编译高工信息，可为release, debug， 可不用。</li>
</ul></li>

<li>编译过程：

<p>cmake -DCMAKE_VERBOSE_MAKEFILE=on -DCMAKE_BUILD_TYPE=release -DCMAKE_INSTALL_PREFIX=/home/kneworld/kde/  -DPKGCONFIG_INSTALL_PREFIX=/home/kneworld/kde/lib/pkgconfig/ ../src/kdesupport/</p>

<p>nice make -j2             使用nice可以让你在编译KDE的时候能正常工作，这调整编译过程的优化级。如果你机器够快，或者临时不用这台机器，可以去掉命令中的nice，让你的机器全速编译KDE。</p>

<p>make install</p></li>

<li>去掉程序中的debug信息：

<p>strip executable  bin file or lib file</p></li>

<li>附脚本：(mykde4_maker.sh)

<p>此脚本默认情况下编译 KDE4 桌面需要的基本包。</p>

<p>如果带个参数 all, 则编译所有 KDE4 包。</p></li>

</ol>


[code type="bash"]

#!/bin/sh

###############
KDEDIR=$HOME/kde/
PKG_CONFIG_PATH=$KDEDIR/lib/pkgconfig/
XDG_DATA_HOME=$KDEDIR/share
XDG_DATA_DIRS=$KDEDIR/share

export KDEDIR PKG_CONFIG_PATH  XDG_DATA_HOME XDG_DATA_DIRS

SRCDIR=$HOME/sources/src/
BUILDDIR=$HOME/sources/build/

##################
function build_package()
{
#       PACKAGE=kdesupport
        PACKAGE=$1
        cd $SRCDIR/$PACKAGE && svn cleanup && svn up
        cd $BUILDDIR && mkdir -p $PACKAGE && cd $PACKAGE
        cmake -DCMAKE_VERBOSE_MAKEFILE=on \
                -DCMAKE_BUILD_TYPE=release \
                -DCMAKE_INSTALL_PREFIX=$KDEDIR  \
                -DPKGCONFIG_INSTALL_PREFIX=$KDEDIR/lib/pkgconfig/   \
                $SRCDIR/$PACKAGE/

        nice make
        make install
}

###########################
KDEBASE_PACKAGES="kdesupport webkitkde KDE/kdelibs KDE/kdepimlibs KDE/kdebase"
KDEALL_PACKAGES="KDE/kdepim KDE/kdegraphics KDE/kdemultimedia KDE/kdenetwork KDE/kdeutils KDE/kdevplatform KDE/kdevelop"
PACKAGES=$KDEBASE_PACKAGES

if [ "$1" = "all" ] ; then
        PACKAGES=$PACKAGES $KDEALL_PACKAGES
fi

for pkg_name in $PACKAGES
do
        echo "Building package $pkg_name now"
        build_package  $pkg_name
done

[/code]

</body>
</html>
