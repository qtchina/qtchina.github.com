
<!DOCTYPE HTML>
<html>
<head>
<meta charset='utf8'>
<title>切换kvm与virtualbox内核驱动模块的自动脚本</title>
</head>
<body>
由于我目前在同时使用virtualbox和kvm,而这两个模块有冲突,所以把内核中的kvm编译成了模块,在需要的时候可以切换这两个模块,选择使用其中任何一种虚拟机驱动.
下面是我用的切换脚本,可以自动检测当前使用的虚拟机模块,把它rmmod掉之后,再加载另一种模块,用起来比较方面,在此帖出,仅做参考.

more swith_vbox_kvm.sh

[code type="bash"]

#vboxnetflt             91444  0
#vboxnetadp             85412  0
#vboxdrv              1699090  1 vboxnetflt

NOW_VM=`lsmod | grep vbox`
if [ x"$NOW_VM" = x"" ] ; then
        echo "Now is kvm, swithing to vbox..."
        rmmod kvm-intel
        rmmod kvm

        modprobe vboxdrv
        modprobe vboxnetadp
        modprobe vboxnetflt
else
        echo "Now is vbox, swithing to kvm..."
        rmmod vboxnetflt
        rmmod vboxnetadp
        rmmod vboxdrv

        modprobe kvm
        modprobe kvm-intel
fi

echo "Switching from    to xxx done."
lsmod | grep kvm
lsmod | grep vbox
echo "enjoy it now!"

[/code]
</body>
</html>
