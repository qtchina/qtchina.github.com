
<!DOCTYPE HTML>
<html>
<head>
<meta charset='utf8'>
<title>第二章 创建对话框（创建 QDialog 的子类）</title>
</head>
<body>
<p style="margin-bottom: 14pt; line-height: 150%;" class="MsoNormal"><strong><span style="font-size: 18pt; line-height: 150%; font-family: 文鼎PL细上海宋Uni;">第二章</span></strong><strong><span lang="EN-US" style="font-size: 18pt; line-height: 150%; font-family: 宋体;">. </span></strong><strong><span style="font-size: 18pt; line-height: 150%; font-family: 文鼎PL细上海宋Uni;">创建对话框</span></strong><strong><span lang="EN-US" style="font-size: 18pt; line-height: 150%; font-family: 宋体;"><o:p></o:p></span></strong></p><br />
<p style="margin: 14pt 0cm; line-height: 150%;" class="MsoNormal"><span lang="EN-US" style="font-family: 宋体;"><!--[if !vml]--><img width="200" height="160" v:shapes="_x0000_i1025" src="/upfile/image/013fig01.jpg" alt="" /><!--[endif]--></span></p><br />
<ul type="disc" style="margin-top: 0cm;"><br />
    <li style="margin-top: 14pt; line-height: 150%;" class="MsoNormal"><span style=""><span style=""><span style=""><span style=""><span style=""><span style="font-family: 文鼎PL细上海宋Uni;">创建</span></span></span></span></span></span><span style=""><span style=""><span lang="EN-US"> </span><span lang="EN-US" style="font-family: 宋体;">QDialog </span><span style="font-family: 文鼎PL细上海宋Uni;">的子类</span></span></span><span lang="EN-US" style="font-family: 宋体;"> <o:p></o:p></span></li><br />
    <li style="line-height: 150%;" class="MsoNormal"><span lang="EN-US"><span style=""><span style=""><span style="font-family: 文鼎PL细上海宋Uni;">深入理解信号与槽的机制</span><span style="font-family: 宋体;">(S</span></span></span><span style=""><span style=""><span style="font-family: 宋体;">ignals and      Slots)</span></span></span></span></li><br />
    <li style="line-height: 150%;" class="MsoNormal"><span lang="EN-US"><span style="font-family: 文鼎PL细上海宋Uni;">快速创建对话框</span></span></li><br />
    <li style="line-height: 150%;" class="MsoNormal"><span lang="EN-US"><span style="font-family: 文鼎PL细上海宋Uni;">可变形对话框</span></span></li><br />
    <li style="line-height: 150%;" class="MsoNormal"><span lang="EN-US"><span style="font-family: 文鼎PL细上海宋Uni;">动态对话框</span></span></li><br />
    <li style="margin-bottom: 14pt; line-height: 150%;" class="MsoNormal"><span lang="EN-US"><span style="font-family: 文鼎PL细上海宋Uni;">内建物件和对话框类</span></span><span lang="EN-US" style="font-family: 宋体;"><o:p></o:p></span></li><br />
</ul><br />
<p style="margin: 14pt 0cm; text-indent: 24pt; line-height: 150%;" class="MsoNormal"><span style="font-family: 文鼎PL细上海宋Uni;">这一章将教你如何利用</span><span lang="EN-US" style="font-family: 宋体;"> Qt </span><span style="font-family: 文鼎PL细上海宋Uni;">创建对话框。对话框向用户提供选项</span><span lang="EN-US" style="font-family: 宋体;">(options)</span><span style="font-family: 文鼎PL细上海宋Uni;">和选择</span><span lang="EN-US" style="font-family: 宋体;">(choices)</span><span style="font-family: 文鼎PL细上海宋Uni;">，允许用户设置他们喜欢的选项值并做出他们的选择。它们之所以被称为对话框或者简单的称为</span><span lang="EN-US" style="font-family: 宋体;">&lsquo;</span><span style="font-family: 文鼎PL细上海宋Uni;">对话</span><span lang="EN-US" style="font-family: 宋体;">&rsquo;</span><span style="font-family: 文鼎PL细上海宋Uni;">，是因为它们提供了一种用户和应用程序用来相互对话的方式。</span><span style="font-family: 文鼎PL细上海宋Uni;"><o:p></o:p></span></p><br />
<p style="margin: 14pt 0cm; text-indent: 24pt; line-height: 150%;" class="MsoNormal"><span style="font-family: 文鼎PL细上海宋Uni;">大多数</span><span lang="EN-US" style="font-family: 宋体;"> GUI </span><span style="font-family: 文鼎PL细上海宋Uni;">应用程序是由一个主窗口、一个菜单栏、若干工具栏和一些作为主窗口补充的对话框构成。单独创建通过适当的行为直接响应用户的选择的对话框程序也是可能的（比如，一个计算器程序）。</span><span lang="EN-US" style="font-family: 宋体;"><o:p></o:p></span></p><br />
<p style="margin: 14pt 0cm; text-indent: 24pt; line-height: 150%;" class="MsoNormal"><span style="font-family: 文鼎PL细上海宋Uni;">首先，我们将通过手写代码创建一个仅有对话框的应用程序向你展示它是怎样被完成的。然后我们将看看如何用</span><span lang="EN-US" style="font-family: 宋体;"> Qt Designer &mdash;&mdash; Qt </span><span style="font-family: 文鼎PL细上海宋Uni;">的可视化设计工具创建对话框。用</span><span lang="EN-US" style="font-family: 宋体;"> Qt Designer </span><span style="font-family: 文鼎PL细上海宋Uni;">要比手写代码快很多，并且使得以后测试不同的设计和更改设计更加容易。</span><span lang="EN-US" style="font-family: 宋体;"><o:p></o:p></span></p><br />
<h3 style="margin-left: 0cm; text-indent: 0cm; line-height: 150%;"><span style="font-family: 文鼎PL细上海宋Uni;">创建</span><span lang="EN-US"> QDialog </span><span style="font-family: 文鼎PL细上海宋Uni;">的子类</span></h3><br />
<p style="text-align: justify; text-indent: 24pt; line-height: 150%;" class="doctext"><span style="font-family: 文鼎PL细上海宋Uni;">我们的第一个例子是一个完全用</span><span lang="EN-US"> C++ </span><span style="font-family: 文鼎PL细上海宋Uni;">写的搜索对话框。我们将用一个单独的类来实现这个对话框。这样做，可以使这个对话框成为一个独立的、自包含的组件，有它自己的信号与槽。</span></p><br />
<h5 align="center" style="margin-left: 0cm; text-align: center; text-indent: 0cm; line-height: 150%;"><a name="ch02fig01"><span style="font-family: 文鼎PL细上海宋Uni;">图</span><span lang="EN-US"> 2.1. The Find dialog</span></a></h5><br />
<p align="center" style="text-align: center; line-height: 150%;" class="doctext"><span lang="EN-US"><!--[if !vml]--><img width="311" height="131" border="0" v:shapes="_x0000_i1026" src="/upfile/image/find.jpg" alt="" /><!--[endif]--></span></p><br />
<p align="center" style="text-align: center; line-height: 150%;" class="MsoNormal"><span lang="EN-US"><o:p>&nbsp;</o:p></span></p><br />
<p style="text-align: justify; text-indent: 24pt; line-height: 150%;" class="doctext"><a name="iddle1625"><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style="font-family: 文鼎PL细上海宋Uni;">源代码被分别放在两个文件：</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></a><tt><span lang="EN-US">finddialog.h</span></tt><span lang="EN-US"> </span><span style="font-family: 文鼎PL细上海宋Uni;">和</span> <tt><span lang="EN-US">finddialog.cpp</span></tt><span style="font-family: 文鼎PL细上海宋Uni;">。我们先从</span> <tt><span lang="EN-US">finddialog.h </span></tt><span style="font-family: 文鼎PL细上海宋Uni;">开始。</span></p><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">1 #ifndef FINDDIALOG_H</span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">2 #define FINDDIALOG_H</span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">3 #include &lt;QDialog&gt;</span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">4 class QCheckBox;</span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">5 class QLabel;</span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">6 class QLineEdit;</span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">7 class QPushButton;</span></pre><br />
<p style="text-align: justify; text-indent: 24pt; line-height: 150%;" class="doctext"><span style="font-family: 文鼎PL细上海宋Uni;">行</span><span lang="EN-US"> 1 </span><span style="font-family: 文鼎PL细上海宋Uni;">和</span><span lang="EN-US"> 2 </span><span style="font-family: 文鼎PL细上海宋Uni;">（和行</span><span lang="EN-US">27</span><span style="font-family: 文鼎PL细上海宋Uni;">）防止这个头文件被多次包含。</span></p><br />
<p style="text-align: justify; text-indent: 24pt; line-height: 150%;" class="doctext"><span style="font-family: 文鼎PL细上海宋Uni;">行</span><span lang="EN-US"> 3 </span><span style="font-family: 文鼎PL细上海宋Uni;">包含了</span><span lang="EN-US"> QDialog </span><span style="font-family: 文鼎PL细上海宋Uni;">的定义，</span><span lang="EN-US"> Qt </span><span style="font-family: 文鼎PL细上海宋Uni;">的对话框基类。</span><span lang="EN-US"> QDialog<span style="">&nbsp; </span></span><span style="font-family: 文鼎PL细上海宋Uni;">继承自</span><span lang="EN-US"> Qwidget </span><span style="font-family: 文鼎PL细上海宋Uni;">类。</span></p><br />
<p style="text-align: justify; text-indent: 24pt; line-height: 150%;" class="doctext"><span style="font-family: 文鼎PL细上海宋Uni;">行</span><span lang="EN-US"> 4 </span><span style="font-family: 文鼎PL细上海宋Uni;">到</span><span lang="EN-US"> 7 </span><span style="font-family: 文鼎PL细上海宋Uni;">前置声明了我们将用来实现对话框的类。前置声明告诉</span><span lang="EN-US"> C++ </span><span style="font-family: 文鼎PL细上海宋Uni;">编译器一个类的存在，不需要给出类定义的所有细节（通常可以从头文件和文件本身找到）。很快我们将对此做进一步介绍。</span></p><br />
<p style="text-align: justify; text-indent: 24pt; line-height: 150%;" class="doctext"><span style="font-family: 文鼎PL细上海宋Uni;">接下来，我们定义一个</span><span lang="EN-US"> QDialog </span><span style="font-family: 文鼎PL细上海宋Uni;">的子类</span><span lang="EN-US"> FindDialog</span><span style="font-family: 文鼎PL细上海宋Uni;">：</span></p><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">8 class FindDialog : public QDialog</span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">9 {</span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">10&nbsp;&nbsp;&nbsp;&nbsp; Q_OBJECT</span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">11 public:</span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">12&nbsp;&nbsp;&nbsp;&nbsp; FindDialog(QWidget *parent = 0);</span></pre><br />
<p style="text-align: justify; text-indent: 24pt; line-height: 150%;" class="doctext"><tt>类定义开头的<span lang="EN-US">Q_OBJECT</span></tt><span lang="EN-US"> </span><span style="font-family: 文鼎PL细上海宋Uni;">宏是所有定义信号或槽的类所必需的。</span></p><br />
<p style="text-align: justify; text-indent: 24pt; line-height: 150%;" class="doctext"><tt>构造函数<span lang="EN-US"> FindDialog</span></tt><span lang="EN-US"> </span><span style="font-family: 文鼎PL细上海宋Uni;">显示了</span><span lang="EN-US"> FindDialog </span><span style="font-family: 文鼎PL细上海宋Uni;">是一个典型的</span><span lang="EN-US"> Qt </span><span style="font-family: 文鼎PL细上海宋Uni;">物件类。</span><tt><span lang="EN-US">parent</span></tt><span lang="EN-US"> </span><span style="font-family: 文鼎PL细上海宋Uni;">参数指向其父物件。默认是一个空指针，说明这个对话框没有父物件。</span></p><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">13 signals:</span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">14&nbsp;&nbsp;&nbsp;&nbsp; void findNext(const QString &amp;str, Qt::CaseSensitivity cs);</span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">15&nbsp;&nbsp;&nbsp;&nbsp; void findPrevious(const QString &amp;str, Qt::CaseSensitivity cs);</span></pre><br />
<p style="text-align: justify; text-indent: 24pt; line-height: 150%;" class="doctext"><span style="font-family: 文鼎PL细上海宋Uni;">信号</span><span lang="EN-US">(signals)</span><span style="font-family: 文鼎PL细上海宋Uni;">部分声明了当用户点击</span><span lang="EN-US"> Find </span><span style="font-family: 文鼎PL细上海宋Uni;">按钮后对话框将发出的两个信号。如果向上选择选项被打开，对话框发出</span><span lang="EN-US"> findPrevious() </span><span style="font-family: 文鼎PL细上海宋Uni;">信号；否则，它发出</span><span lang="EN-US"> findNext()</span><span style="font-family: 文鼎PL细上海宋Uni;">信号。</span></p><br />
<p style="text-align: justify; text-indent: 24pt; line-height: 150%;" class="doctext"><span style="font-family: 文鼎PL细上海宋Uni;">关键字</span> <tt><span lang="EN-US">signals</span></tt><span lang="EN-US"> </span><span style="font-family: 文鼎PL细上海宋Uni;">实际上是一个宏。</span><span lang="EN-US">C++ </span><span style="font-family: 文鼎PL细上海宋Uni;">预处理器在它被送到编译器之前将把它转化成标准</span><span lang="EN-US"> C++</span><span style="font-family: 文鼎PL细上海宋Uni;">。</span><tt><span style="">Qt::CaseSensitivity</span></tt><span style=""> </span><span style="font-family: 文鼎PL细上海宋Uni;">是一个取值为</span><span style=""> </span><tt><span style="">Qt::CaseSensitive 和Qt::CaseInsensitive的</span></tt><span style="font-family: 文鼎PL细上海宋Uni;">枚举类型数据。</span><span style=""><o:p></o:p></span></p><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span style="">16 private slots:<o:p></o:p></span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span style="">17&nbsp;&nbsp;&nbsp;&nbsp; void findClicked();<o:p></o:p></span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span style="">18&nbsp;&nbsp;&nbsp;&nbsp; void enableFindButton(const QString &amp;text);<o:p></o:p></span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span style="">19 private:<o:p></o:p></span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">20&nbsp;&nbsp;&nbsp;&nbsp; QLabel *label;</span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">21&nbsp;&nbsp;&nbsp;&nbsp; QLineEdit *lineEdit;</span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">22&nbsp;&nbsp;&nbsp;&nbsp; QCheckBox *caseCheckBox;</span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">23&nbsp;&nbsp;&nbsp;&nbsp; QCheckBox *backwardCheckBox;</span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">24&nbsp;&nbsp;&nbsp;&nbsp; QPushButton *findButton;</span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">25&nbsp;&nbsp;&nbsp;&nbsp; QPushButton *closeButton;</span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">26 };</span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">27 #endif</span><a name="iddle2147"></a></pre><br />
<p><a name="iddle2147"><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style="font-family: 文鼎PL细上海宋Uni;">&nbsp;&nbsp; 在类的私有定义</span><span lang="EN-US">(private)</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></a><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style="font-family: 文鼎PL细上海宋Uni;">部分，我们定义了两个槽。要实现这两个槽，我们需要访问对话框的大部分子物件，所以我们也保存了指向他们的指针。关键词</span><span lang="EN-US"> slots</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style="font-family: 文鼎PL细上海宋Uni;">，就像</span><span lang="EN-US"> signals</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style="font-family: 文鼎PL细上海宋Uni;">，也是一个可以转化为一个</span><span lang="EN-US"> C++ </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style="font-family: 文鼎PL细上海宋Uni;">编译器能够识别的结构体</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><br />
<p style="text-align: justify; text-indent: 24pt; line-height: 150%;" class="doctext"><span style="font-family: 文鼎PL细上海宋Uni;">对于私有变量，我们前置声明了他们的类指针。这是可能的，因为他们都是指针并且我们不在头文件中存取它们，所以编译器不需要类的完整定义。当然，我们本应该包含相关的头文件</span><span lang="EN-US">(&lt;QCheckBox&gt;,&lt;QLabel&gt;,</span><span style="font-family: 文鼎PL细上海宋Uni;">等</span><span lang="EN-US">)</span><span style="font-family: 文鼎PL细上海宋Uni;">，但是利用前置声明如果可能的话可以使编译的速度稍微加快。</span></p><br />
<p style="text-align: justify; text-indent: 24pt; line-height: 150%;" class="doctext"><span style="font-family: 文鼎PL细上海宋Uni;">我们现在看看包含了</span><span lang="EN-US"> FindDialog </span><span style="font-family: 文鼎PL细上海宋Uni;">类实现的</span> <tt><span lang="EN-US">finddialog.cpp </span>的内容</tt><span style="font-family: 文鼎PL细上海宋Uni;">。</span></p><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">1&nbsp; #include &lt;QtGui&gt;</span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">2&nbsp; #include &quot;finddialog.h&quot;</span></pre><br />
<p style="text-indent: 24pt; line-height: 150%;" class="MsoNormal"><span lang="EN-US"><o:p>&nbsp;</o:p></span></p><br />
<p style="text-align: justify; text-indent: 24pt; line-height: 150%;" class="doctext"><span style="font-family: 文鼎PL细上海宋Uni;">首先，我们包含了</span><span lang="EN-US"> &lt;QtGui&gt;</span><span style="font-family: 文鼎PL细上海宋Uni;">，一个包含</span><span lang="EN-US"> Qt </span><span style="font-family: 文鼎PL细上海宋Uni;">的</span><span lang="EN-US"> GUI </span><span style="font-family: 文鼎PL细上海宋Uni;">类定义的头文件。</span><span lang="EN-US">Qt</span><span style="font-family: 文鼎PL细上海宋Uni;">由几个模块组成，</span><span style="color: black;">每个模块都是自成一体独立的库</span><span style="font-family: 文鼎PL细上海宋Uni;">。</span><span style="font-family: 文鼎PL细上海宋Uni;">最重要的几个模块是：</span><span style="">QtCore, QtGui, QtNetwork,<span style="">&nbsp; </span>QtOpenGL, QtSql, QtSvg </span><span style="font-family: 文鼎PL细上海宋Uni;">和</span><span style=""> QtXml</span><span style="font-family: 文鼎PL细上海宋Uni;">。</span><span lang="EN-US">&lt;QtGui&gt;</span><span style="font-family: 文鼎PL细上海宋Uni;">头文件包含了</span><span lang="EN-US">QtCore </span><span style="font-family: 文鼎PL细上海宋Uni;">和</span><span lang="EN-US">QtGui </span><span style="font-family: 文鼎PL细上海宋Uni;">模块中所有类的定义</span><span style="font-family: 文鼎PL细上海宋Uni;">。包含这个头文件可以免去我们一个一个包含每个单独的类的麻烦。</span><span style=""><o:p></o:p></span></p><br />
<p style="text-align: justify; text-indent: 24pt; line-height: 150%;" class="doctext"><span style="font-family: 文鼎PL细上海宋Uni;">在</span><span style=""> </span><span lang="EN-US">filedialog.h </span><span style="font-family: 文鼎PL细上海宋Uni;">中，我们可以简单地用包含</span><span lang="EN-US"> &lt;QtGui&gt; </span><span style="font-family: 文鼎PL细上海宋Uni;">来代替</span><span lang="EN-US"> &lt;QDialog&gt; </span><span style="font-family: 文鼎PL细上海宋Uni;">的包含和</span><span lang="EN-US">QCheckBox, Qlabel, QlineEdit, QPushButton</span><span style="font-family: 文鼎PL细上海宋Uni;">的前置声明。</span><span style="font-family: 文鼎PL细上海宋Uni;">但是，在一个头文件中包含另一个大的头文件通常是一个不好的风格，尤其是在大型应用程序的开发中。</span><span style=""><o:p></o:p></span></p><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">3 FindDialog::FindDialog(QWidget *parent)</span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">4<span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>: QDialog(parent)</span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">5 {</span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">6&nbsp;&nbsp;&nbsp;&nbsp;label = new QLabel(tr(&quot;Find &amp;what:&quot;));</span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">7&nbsp;&nbsp;&nbsp;&nbsp; lineEdit = new QLineEdit;</span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">8&nbsp;&nbsp;&nbsp;&nbsp; label-&gt;setBuddy(lineEdit);</span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">9&nbsp;&nbsp;&nbsp;&nbsp; caseCheckBox = new QCheckBox(tr(&quot;Match &amp;case&quot;));</span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">10&nbsp;&nbsp;&nbsp;&nbsp; backwardCheckBox = new QCheckBox(tr(&quot;Search &amp;backward&quot;));</span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">11&nbsp;&nbsp;&nbsp;&nbsp; findButton = new QPushButton(tr(&quot;&amp;Find&quot;));</span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">12&nbsp;&nbsp;&nbsp;&nbsp;findButton-&gt;setDefault(true);</span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">13&nbsp;&nbsp;&nbsp;&nbsp;findButton-&gt;setEnabled(false);</span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">14&nbsp;&nbsp;&nbsp;&nbsp; closeButton = new QPushButton(tr(&quot;Close&quot;));</span></pre><br />
<p style="text-align: justify; text-indent: 24pt; line-height: 150%;" class="doctext"><a name="iddle1003"><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style="font-family: 文鼎PL细上海宋Uni;">在第</span><span lang="EN-US"> 4 </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></a><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style="font-family: 文鼎PL细上海宋Uni;">行，我们向基类的构造函数传递</span><span lang="EN-US"> p</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><tt><span lang="EN-US">arent</span></tt><span lang="EN-US"> </span><span style="font-family: 文鼎PL细上海宋Uni;">参数。然后我们创建子物件。</span> <span style="font-family: 文鼎PL细上海宋Uni;">用字符串文本作为参数调用</span> <tt><span lang="EN-US">tr()</span></tt><span lang="EN-US"> </span><span style="font-family: 文鼎PL细上海宋Uni;">函数可以标记出它们来翻译成其他语言。这个函数在</span><span lang="EN-US"> QObject </span><span style="font-family: 文鼎PL细上海宋Uni;">和所有包含</span><span lang="EN-US"> Q_OBJECT </span><span style="font-family: 文鼎PL细上海宋Uni;">宏的子类中声明。用</span><span lang="EN-US"> TR() </span><span style="font-family: 文鼎PL细上海宋Uni;">包围用户可视的字符串是一个好的习惯，即使你没有立即将你的应用程序翻译成其他语言的打算。翻译</span><span lang="EN-US"> Qt </span><span style="font-family: 文鼎PL细上海宋Uni;">应用程序将在</span> <span lang="EN-US"><span style=""><span style=""><span style="font-family: 文鼎PL细上海宋Uni;">第十七章</span></span></span></span><span style="font-family: 文鼎PL细上海宋Uni;">做详细介绍。</span></p><br />
<p style="text-align: justify; text-indent: 24pt; line-height: 150%;" class="doctext"><span style="font-family: 文鼎PL细上海宋Uni;">在字符串文本中，我们</span><span lang="EN-US">'&amp;'</span><span style="font-family: 文鼎PL细上海宋Uni;">符号指示快捷键。例如，在行</span><span lang="EN-US"> 11 </span><span style="font-family: 文鼎PL细上海宋Uni;">创建了一个</span><span lang="EN-US"> Find </span><span style="font-family: 文鼎PL细上海宋Uni;">按钮，用户可以在支持快捷键的系统上用快捷键</span><span lang="EN-US"> Alt+F</span><span style="font-family: 文鼎PL细上海宋Uni;">来激活它。</span><span lang="EN-US">'&amp;'</span><span style="font-family: 文鼎PL细上海宋Uni;">符号还可以用来控制焦点：在第</span><span lang="EN-US">6</span><span style="font-family: 文鼎PL细上海宋Uni;">行，我们创建了一个带有一个快捷键</span><span lang="EN-US">(Alt+W)</span><span style="font-family: 文鼎PL细上海宋Uni;">的标签，在第</span><span lang="EN-US">8</span><span style="font-family: 文鼎PL细上海宋Uni;">行我们设置标签的伙伴</span><span lang="EN-US">(buddy)</span><span style="font-family: 文鼎PL细上海宋Uni;">为行编辑器。一个伙伴</span><span lang="EN-US">(buddy)</span><span style="font-family: 文鼎PL细上海宋Uni;">是一个在标签的快捷键被按下时接受焦点的物件。所以当用户按下</span><span lang="EN-US"> Alt+W</span><span style="font-family: 文鼎PL细上海宋Uni;">（标签的快捷键），行编辑器（标签的伙伴）将拥有焦点。</span></p><br />
<p style="text-align: justify; text-indent: 24pt; line-height: 150%;" class="doctext"><span style="font-family: 文鼎PL细上海宋Uni;">在第</span><span lang="EN-US">12</span><span style="font-family: 文鼎PL细上海宋Uni;">行，我们调用</span><span lang="EN-US"> setDefault(true) </span><span style="font-family: 文鼎PL细上海宋Uni;">将</span><span lang="EN-US"> Find </span><span style="font-family: 文鼎PL细上海宋Uni;">按钮设置为对话框的默认按钮。默认按钮是当用户敲回车后将被按下的按钮。在第</span><span lang="EN-US">13</span><span style="font-family: 文鼎PL细上海宋Uni;">行，我们禁用了</span><span lang="EN-US"> Find </span><span style="font-family: 文鼎PL细上海宋Uni;">按钮。当一个物件被禁用，它通常灰化显示并且不再响应用户的交互。</span></p><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">15&nbsp;&nbsp;&nbsp;&nbsp; connect(lineEdit, SIGNAL(textChanged(const QString &amp;)),</span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">16&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this, SLOT(enableFindButton(const QString &amp;)));</span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">17&nbsp;&nbsp;&nbsp;&nbsp; connect(findButton, SIGNAL(clicked()),</span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">18&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this, SLOT(findClicked()));</span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">19&nbsp;&nbsp;&nbsp;&nbsp; connect(closeButton, SIGNAL(clicked()),</span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">20&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this, SLOT(close()));</span></pre><br />
<p style="text-align: justify; text-indent: 24pt; line-height: 150%;" class="doctext"><span style="font-family: 文鼎PL细上海宋Uni;">私有槽</span> <tt><span lang="EN-US">enableFindButton(const QString &amp;)</span></tt><span lang="EN-US"> </span><span style="font-family: 文鼎PL细上海宋Uni;">将在每次行编辑器中的文本有所改变的时候被调用。私有槽</span> <tt><span lang="EN-US">findClicked()</span></tt><span lang="EN-US"> </span><span style="font-family: 文鼎PL细上海宋Uni;">将在用户点击</span><span lang="EN-US"> Find </span><span style="font-family: 文鼎PL细上海宋Uni;">按钮时被调用。当用户点击</span><span lang="EN-US"> Close </span><span style="font-family: 文鼎PL细上海宋Uni;">时对话框将关闭。槽</span> <tt><span lang="EN-US">close()</span></tt><span lang="EN-US"> </span><span style="font-family: 文鼎PL细上海宋Uni;">是从</span><span lang="EN-US"> Qwidget </span><span style="font-family: 文鼎PL细上海宋Uni;">继承而来，它的默认行为是从视图中隐藏物件（而不是删除它）。</span><span style="font-family: 文鼎PL细上海宋Uni;">稍后，我们将看一下</span><span style=""> </span><tt><span style="">enableFindButton()</span></tt><span style=""> </span><span style="font-family: 文鼎PL细上海宋Uni;">槽</span><span style=""> </span><tt><span style="">findClicked()</span></tt><span style=""> </span><span style="font-family: 文鼎PL细上海宋Uni;">的源代码。</span><span style=""><o:p></o:p></span></p><br />
<p style="text-align: justify; text-indent: 24pt; line-height: 150%;" class="doctext"><span style="font-family: 文鼎PL细上海宋Uni;">因为</span><span style=""> </span><tt><span style="">QObject</span></tt><span style=""> </span><span style="font-family: 文鼎PL细上海宋Uni;">是</span><span style=""> </span><tt><span style="">FindDialog </span></tt><span style="font-family: 文鼎PL细上海宋Uni;">的一个祖先类，你可以省略</span><span style=""> connect() </span><span style="font-family: 文鼎PL细上海宋Uni;">调用前面的</span><span style=""> QObject:: </span><span style="font-family: 文鼎PL细上海宋Uni;">前缀。</span><span style=""><o:p></o:p></span></p><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span style="">21<span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>QHBoxLayout *topLeftLayout = new QHBoxLayout;<o:p></o:p></span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">22<span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>topLeftLayout-&gt;addWidget(label);</span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">23&nbsp;&nbsp;&nbsp;&nbsp;topLeftLayout-&gt;addWidget(lineEdit);</span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">24&nbsp;&nbsp;&nbsp;&nbsp; QVBoxLayout *leftLayout = new QVBoxLayout;</span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">25&nbsp;&nbsp;&nbsp;&nbsp;leftLayout-&gt;addLayout(topLeftLayout);</span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">26&nbsp;&nbsp;&nbsp;&nbsp;leftLayout-&gt;addWidget(caseCheckBox);</span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">27&nbsp;&nbsp;&nbsp;&nbsp;leftLayout-&gt;addWidget(backwardCheckBox);</span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">28&nbsp;&nbsp;&nbsp;&nbsp; QVBoxLayout *rightLayout = new QVBoxLayout;</span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">29&nbsp;&nbsp;&nbsp;&nbsp;rightLayout-&gt;addWidget(findButton);</span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">30&nbsp;&nbsp;&nbsp;&nbsp;rightLayout-&gt;addWidget(closeButton);</span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">31&nbsp;&nbsp;&nbsp;&nbsp;rightLayout-&gt;addStretch();</span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">32&nbsp;&nbsp;&nbsp;&nbsp; QHBoxLayout *mainLayout = new QHBoxLayout;</span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">33&nbsp;&nbsp;&nbsp;&nbsp;mainLayout-&gt;addLayout(leftLayout);</span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">34&nbsp;&nbsp;&nbsp;&nbsp;mainLayout-&gt;addLayout(rightLayout);</span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">35&nbsp;&nbsp;&nbsp;&nbsp;setLayout(mainLayout);</span></pre><br />
<p style="line-height: 150%;" class="MsoNormal"><span lang="EN-US"><o:p>&nbsp;</o:p></span></p><br />
<p style="text-align: justify; text-indent: 24pt; line-height: 150%;" class="doctext"><a name="iddle1419"><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style="font-family: 文鼎PL细上海宋Uni;">接下来，我们用布局管理器来布局子物件。</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></a><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style="font-family: 文鼎PL细上海宋Uni;">布局可以包含物件和其他布局。通过不同的组合嵌套</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""> QHBoxLayouts</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style="font-family: 文鼎PL细上海宋Uni;">、</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style="">QVBoxLayouts</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style="font-family: 文鼎PL细上海宋Uni;">和</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style="">QGridLayouts</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style="font-family: 文鼎PL细上海宋Uni;">，你可以创建一些很专业的对话框。</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span style=""><o:p></o:p></span></p><br />
<p style="text-align: justify; text-indent: 24pt; line-height: 150%;" class="doctext"><span style="font-family: 文鼎PL细上海宋Uni;">对于</span><span style=""> Find </span><span style="font-family: 文鼎PL细上海宋Uni;">对话框，我们用了两个</span><span style=""> QHBoxLayouts </span><span style="font-family: 文鼎PL细上海宋Uni;">和两个</span><span style=""> QVBoxLayouts</span><span style="font-family: 文鼎PL细上海宋Uni;">，就像</span><span style=""> </span><span lang="EN-US"><span style=""><span style=""><span style="font-family: 文鼎PL细上海宋Uni;">图</span><span style=""> 2.2</span></span></span></span><span lang="EN-US" style=""> </span><span style="font-family: 文鼎PL细上海宋Uni;">展示的那样，外层布局是主要布局；它在</span><span style="">35</span><span style="font-family: 文鼎PL细上海宋Uni;">行被安装到</span><span style=""> FindDialog </span><span style="font-family: 文鼎PL细上海宋Uni;">用来响应整个对话框的行为。</span><span style="font-family: 文鼎PL细上海宋Uni;">其它三个布局是子布局。</span> <span lang="EN-US"><span style=""><span style=""><span style="font-family: 文鼎PL细上海宋Uni;">图</span> 2.2</span></span></span><span style="font-family: 文鼎PL细上海宋Uni;">右下角的</span><span lang="EN-US">&ldquo;</span><span style="font-family: 文鼎PL细上海宋Uni;">弹簧</span><span lang="EN-US">&rdquo;</span><span style="font-family: 文鼎PL细上海宋Uni;">是一个空白项</span><span lang="EN-US"> (</span><span style="font-family: 文鼎PL细上海宋Uni;">或称</span><span lang="EN-US"> &ldquo;</span><span style="font-family: 文鼎PL细上海宋Uni;">伸展</span><span lang="EN-US">&rdquo;)</span><span style="font-family: 文鼎PL细上海宋Uni;">。它用来填充</span><span lang="EN-US"> Find </span><span style="font-family: 文鼎PL细上海宋Uni;">和</span><span lang="EN-US"> Close </span><span style="font-family: 文鼎PL细上海宋Uni;">按钮下的空白，确保这两个按钮占据他所在布局的上部。</span></p><br />
<h5 align="center" style="margin-left: 0cm; text-align: center; text-indent: 0cm; line-height: 150%;"><a name="ch02fig02"><!--[if !supportLists]--><!--[endif]--><span style="font-family: 文鼎PL细上海宋Uni;">图</span><span lang="EN-US"> 2.2. The Find dialog</span></a><span lang="EN-US">'s layouts</span></h5><br />
<p align="center" style="text-align: center; line-height: 150%;" class="MsoNormal"><span lang="EN-US"><!--[if !vml]--><img border="0" v:shapes="_x0000_i1027" src="/upfile/image/find_dialog_s_layouts.jpg" alt="" /><!--[endif]--></span></p><br />
<p style="line-height: 150%;" class="MsoNormal"><span lang="EN-US"><o:p>&nbsp;</o:p></span></p><br />
<p style="text-align: justify; text-indent: 24pt; line-height: 150%;" class="doctext"><span style="font-family: 文鼎PL细上海宋Uni;">比较微妙的一点是布局管理类不是物件，相反，它继承自</span><span lang="EN-US"> Qlayout</span><span style="font-family: 文鼎PL细上海宋Uni;">，而</span><span lang="EN-US"> QLayout</span><span style="font-family: 文鼎PL细上海宋Uni;">则继承了</span><span lang="EN-US">QObject</span><span style="font-family: 文鼎PL细上海宋Uni;">。图中，物件用实线框代表而布局用虚线框代表作为两者之间的区别。布局在程序运行时是不可见的。</span></p><br />
<p style="text-align: justify; text-indent: 24pt; line-height: 150%;" class="doctext"><span style="font-family: 文鼎PL细上海宋Uni;">当子布局被加入到父布局时</span><span lang="EN-US"> (</span><span style="font-family: 文鼎PL细上海宋Uni;">行</span><span lang="EN-US"> 25, 33, </span><span style="font-family: 文鼎PL细上海宋Uni;">和</span><span lang="EN-US"> 34)</span><span style="font-family: 文鼎PL细上海宋Uni;">，子布局的父布局会被自动重新布局。然后，当主布局被安装到对话框（行</span><span lang="EN-US"> 35</span><span style="font-family: 文鼎PL细上海宋Uni;">），它会变成对话框的子布局。</span><span lang="EN-US"><span style=""><span style=""><span style="font-family: 文鼎PL细上海宋Uni;">图</span>2.3</span></span></span><span style="font-family: 文鼎PL细上海宋Uni;">描述了这一父子继承关系。</span></p><br />
<h5 align="center" style="margin-left: 0cm; text-align: center; text-indent: 0cm; line-height: 150%;"><a name="ch02fig03"><span style="font-family: 文鼎PL细上海宋Uni;">图</span><span lang="EN-US"> 2.3. The Find dialog</span></a><span lang="EN-US">'s parentchild relationships</span></h5><br />
<p align="center" style="text-align: center; line-height: 150%;" class="doctext"><span lang="EN-US"><!--[if !vml]--><img width="262" height="161" border="0" v:shapes="_x0000_i1028" src="/upfile/image/find_dialog_s.jpg" alt="" /><!--[endif]--></span></p><br />
<p style="line-height: 150%;" class="MsoNormal"><span lang="EN-US"><o:p>&nbsp;</o:p></span></p><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">36<span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>setWindowTitle(tr(&quot;Find&quot;));</span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">37<span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>setFixedHeight(sizeHint().height());</span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">38 }</span></pre><br />
<p style="line-height: 150%;" class="MsoNormal"><span lang="EN-US"><o:p>&nbsp;</o:p></span></p><br />
<p style="text-align: justify; text-indent: 24pt; line-height: 150%;" class="doctext"><span style="font-family: 文鼎PL细上海宋Uni;">最后，我们将为对话框设置在标题栏显示的标题并为窗口设置一个固定高度，因为对话框中没有任何一个物件可以占据额外的垂直空间。</span> <span lang="EN-US">QWidget::sizeHint() </span><span style="font-family: 文鼎PL细上海宋Uni;">函数返回一个物件的理想大小。</span></p><br />
<p style="text-align: justify; text-indent: 24pt; line-height: 150%;" class="doctext"><span style="font-family: 文鼎PL细上海宋Uni;">以上我们完整的定义了</span> <span lang="EN-US">FindDialog </span><span style="font-family: 文鼎PL细上海宋Uni;">的构造函数。既然我们用</span><span lang="EN-US"> new </span><span style="font-family: 文鼎PL细上海宋Uni;">创建了一个对话框物件和布局，看起来我们需要写一个析构函数对每一个我们创建的物件调用</span><span lang="EN-US"> delete </span><span style="font-family: 文鼎PL细上海宋Uni;">。但这并不是必需的，因为</span><span lang="EN-US"> Qt </span><span style="font-family: 文鼎PL细上海宋Uni;">会在父对象销毁时自动释放子对象，并且子物件和布局都是</span><span lang="EN-US"> FindDialog </span><span style="font-family: 文鼎PL细上海宋Uni;">的派生物。</span></p><br />
<p style="text-align: justify; text-indent: 24pt; line-height: 150%;" class="doctext"><span style="font-family: 文鼎PL细上海宋Uni;">现在我们看一下对话框的槽：</span></p><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">39 void FindDialog::findClicked()</span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">40 {</span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">41&nbsp;&nbsp;&nbsp;&nbsp; QString text = lineEdit-&gt;text();</span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><st1:chmetcnv w:st="on" unitname="qt" sourcevalue="42" hasspace="True" negative="False" numbertype="1" tcsc="0"><span lang="EN-US">42&nbsp;&nbsp;&nbsp;&nbsp; Qt</span></st1:chmetcnv><span lang="EN-US">::CaseSensitivity cs =</span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">43&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;caseCheckBox-&gt;isChecked() ? Qt::CaseSensitive</span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">44&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: Qt::CaseInsensitive;</span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">45&nbsp;&nbsp;&nbsp;&nbsp; if (backwardCheckBox-&gt;isChecked()) {</span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">46&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;emit findPrevious(text, cs);</span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">47<span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>} else {</span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">48<span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>emit findNext(text, cs);</span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">49<span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">50 }</span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">51 void FindDialog::enableFindButton(const QString &amp;text)</span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">52 {</span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">53<span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>findButton-&gt;setEnabled(!text.isEmpty());</span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">54 }</span></pre><br />
<p style="text-align: justify; text-indent: 24pt; line-height: 150%;" class="doctext"><span style="font-family: 文鼎PL细上海宋Uni;">当用户点击</span><span lang="EN-US"> Find </span><span style="font-family: 文鼎PL细上海宋Uni;">按钮时槽</span> <span lang="EN-US">findClicked() </span><span style="font-family: 文鼎PL细上海宋Uni;">会被调用，</span><span lang="EN-US">Find </span><span style="font-family: 文鼎PL细上海宋Uni;">按钮会发出</span> <span lang="EN-US">findPrevious() </span><span style="font-family: 文鼎PL细上海宋Uni;">或</span> <span lang="EN-US">findNext() </span><span style="font-family: 文鼎PL细上海宋Uni;">信号，这取决于向后选择</span><span lang="EN-US"> (Search backward) </span><span style="font-family: 文鼎PL细上海宋Uni;">选项。关键词</span> <span lang="EN-US">emit </span><span style="font-family: 文鼎PL细上海宋Uni;">是</span><span lang="EN-US"> Qt </span><span style="font-family: 文鼎PL细上海宋Uni;">独有的；象其它</span><span lang="EN-US"> Qt </span><span style="font-family: 文鼎PL细上海宋Uni;">扩展它会被</span><span lang="EN-US"> C++ </span><span style="font-family: 文鼎PL细上海宋Uni;">预处理器转换成标准的</span><span lang="EN-US"> C++</span><span style="font-family: 文鼎PL细上海宋Uni;">。</span></p><br />
<p style="text-align: justify; text-indent: 24pt; line-height: 150%;" class="doctext"><a name="iddle2532"><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><span style="font-family: 文鼎PL细上海宋Uni;">无论何时，在用户改变行编辑器的文本的时候，槽</span> </span></span></span></span></span></span></span></span></span></span></span></span></span></span></a><span lang="EN-US">enableFindButton() </span><span style="font-family: 文鼎PL细上海宋Uni;">会被调用，如果编辑器里有文本会使按钮可用，没有则不可用。</span></p><br />
<p style="text-align: justify; text-indent: 24pt; line-height: 150%;" class="doctext"><span style="font-family: 文鼎PL细上海宋Uni;">这两个槽完善了对话框。现在我们创建一个</span><span lang="EN-US">main.cpp </span><span style="font-family: 文鼎PL细上海宋Uni;">文件来测试我们的</span><span lang="EN-US">uangg</span><span style="font-family: 文鼎PL细上海宋Uni;">和</span><span lang="EN-US">eFindDialog </span><span style="font-family: 文鼎PL细上海宋Uni;">物件：</span></p><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">1 #include &lt;QApplication&gt;</span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">2 #include &quot;finddialog.h&quot;</span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">3 int main(int argc, char *argv[])</span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">4 {</span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">5<span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>QApplication app(argc, argv);</span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">6<span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>FindDialog *dialog = new FindDialog;</span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">7<span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>dialog-&gt;show();</span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">8<span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>return app.exec();</span></pre><br />
<pre style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span lang="EN-US">9 }</span></pre><br />
<p style="text-align: justify; text-indent: 24pt; line-height: 150%;" class="doctext"><span style="font-family: 文鼎PL细上海宋Uni;">要编译这个程序，运行</span><span lang="EN-US"> qmake</span><span style="font-family: 文鼎PL细上海宋Uni;">。因为</span><span lang="EN-US"> FindDialog </span><span style="font-family: 文鼎PL细上海宋Uni;">类的定义包含了</span><span lang="EN-US"> Q_OBJECT </span><span style="font-family: 文鼎PL细上海宋Uni;">宏，由</span><span lang="EN-US"> qmake </span><span style="font-family: 文鼎PL细上海宋Uni;">生成的</span><span lang="EN-US"> makefile </span><span style="font-family: 文鼎PL细上海宋Uni;">将包含运行</span><span lang="EN-US"> moc &mdash;&mdash;Qt </span><span style="font-family: 文鼎PL细上海宋Uni;">的元对象编译器的特殊规则（</span><span lang="EN-US">Qt </span><span style="font-family: 文鼎PL细上海宋Uni;">元对象系统将在下一部分讲解）。</span></p><br />
<p style="text-align: justify; text-indent: 24pt; line-height: 150%;" class="doctext"><span style="font-family: 文鼎PL细上海宋Uni;">为了使</span> <span lang="EN-US">moc </span><span style="font-family: 文鼎PL细上海宋Uni;">正确工作，我们必需将类的定义放到一个头文件，从实现文件中分离出来。由</span><span lang="EN-US"> moc </span><span style="font-family: 文鼎PL细上海宋Uni;">生成的代码包含这个头文件并且添加一些</span><span lang="EN-US"> C++ </span><span style="font-family: 文鼎PL细上海宋Uni;">自有的魔力</span><span lang="EN-US">(magic)</span><span style="font-family: 文鼎PL细上海宋Uni;">。</span></p><br />
<p style="text-align: justify; text-indent: 24pt; line-height: 150%;" class="doctext"><span style="font-family: 文鼎PL细上海宋Uni;">运用</span><span lang="EN-US"> Q_OBJECT </span><span style="font-family: 文鼎PL细上海宋Uni;">宏的类必需运行</span><span lang="EN-US"> moc</span><span style="font-family: 文鼎PL细上海宋Uni;">。这不是问题因为</span><span lang="EN-US"> qmake </span><span style="font-family: 文鼎PL细上海宋Uni;">会自动向</span><span lang="EN-US">makefile </span><span style="font-family: 文鼎PL细上海宋Uni;">添加需要的规则。但是如果你忘记用</span><span lang="EN-US"> qmake </span><span style="font-family: 文鼎PL细上海宋Uni;">重新生成你的</span><span lang="EN-US"> makefile </span><span style="font-family: 文鼎PL细上海宋Uni;">文件，并且没有运行</span><span lang="EN-US"> moc</span><span style="font-family: 文鼎PL细上海宋Uni;">，连接器会报告一些函数没有实现就被声明了。显示信息可能相当晦涩。</span><span lang="EN-US">GCC </span><span style="font-family: 文鼎PL细上海宋Uni;">产生的警告象下面这样：</span></p><br />
<pre style="text-align: justify; line-height: 150%;"><span lang="EN-US"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>finddialog.o: In function 'FindDialog::tr(char const*, char const*)':</span></pre><br />
<pre style="text-align: justify; line-height: 150%;"><span lang="EN-US"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>/usr/lib/qt/src/corelib/global/qglobal.h:1430: undefined reference to</span></pre><br />
<pre style="text-align: justify; line-height: 150%;"><span lang="EN-US"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>'FindDialog::staticMetaObject'</span></pre><br />
<p style="line-height: 150%;" class="MsoNormal"><span lang="EN-US"><o:p>&nbsp;</o:p></span></p><br />
<p style="text-align: justify; text-indent: 24pt; line-height: 150%;" class="doctext"><span lang="EN-US">Visual C++ </span><span style="font-family: 文鼎PL细上海宋Uni;">则会这样显示：</span></p><br />
<pre style="text-align: justify; line-height: 150%;"><span lang="EN-US"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>finddialog.obj : error LNK2001: unresolved external symbol</span></pre><br />
<pre style="text-align: justify; line-height: 150%;"><span lang="EN-US"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>&quot;public:~virtual int __thiscall MyClass::qt_metacall(enum QMetaObject</span></pre><br />
<pre style="text-align: justify; line-height: 150%;"><span lang="EN-US"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>::Call,int,void * *)&quot;</span></pre><br />
<p style="text-align: justify; text-indent: 24pt; line-height: 150%;" class="doctext"><span style="font-family: 文鼎PL细上海宋Uni;">如果这在你身上发生，运行</span><span lang="EN-US"> qmake </span><span style="font-family: 文鼎PL细上海宋Uni;">升级你的</span><span lang="EN-US">makefile</span><span style="font-family: 文鼎PL细上海宋Uni;">，然后重新编译应用程序。</span></p><br />
<p style="text-align: justify; text-indent: 24pt; line-height: 150%;" class="doctext"><span style="font-family: 文鼎PL细上海宋Uni;">现在运行程序。如果你的系统支持快捷键，用</span><span lang="EN-US"> Alt+W</span><span style="font-family: 文鼎PL细上海宋Uni;">、</span><span lang="EN-US">Alt+C</span><span style="font-family: 文鼎PL细上海宋Uni;">、</span><span lang="EN-US">Alt+B</span><span style="font-family: 文鼎PL细上海宋Uni;">和</span><span lang="EN-US"> Alt+F</span><span style="font-family: 文鼎PL细上海宋Uni;">验证它们是否触发正确的行为。按</span><span lang="EN-US"> Tab </span><span style="font-family: 文鼎PL细上海宋Uni;">键浏览所有的物件。默认的</span><span lang="EN-US"> Tab </span><span style="font-family: 文鼎PL细上海宋Uni;">顺序是物件被创建的顺序。可以用</span> <tt><span lang="EN-US">QWidget::setTabOrder() </span>改变默认顺序。</tt></p><br />
<p class="doctext" style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span style="font-family: 文鼎PL细上海宋Uni;">提供一个明智的 Tab顺序和键盘快捷键确保不喜欢（或者不能）用鼠标的用户能够充分利用这个应用程序。完全的键盘控制也被快速的打字员所欣赏。</span></p><br />
<p class="doctext" style="text-align: justify; text-indent: 24pt; line-height: 150%;"><span style="font-family: 文鼎PL细上海宋Uni;">在 第三章，我们将把 Find 对话框运用到真实的应用程序，并且连接 findPrevious()和 findNext()信号到某些槽。</span></p>
</body>
</html>
