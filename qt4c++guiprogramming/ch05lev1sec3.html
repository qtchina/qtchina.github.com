<html>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<head>
<title>Integrating Custom Widgets with Qt Designer</title>
<link rel="STYLESHEET" type="text/css" href="images/style.css">
<link rel="STYLESHEET" type="text/css" href="images/docsafari.css">
</head>
<body>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch05lev1sec2.html><img src="images/prev.gif" width="60" height="17" border="0" align="absmiddle" alt="Previous Page"></a>
<td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch05lev1sec4.html><img src="images/next.gif" width="60" height="17" border="0" align="absmiddle" alt="Next Page"></a>
</div></td></tr></table>
<br><table width="100%" border="0" cellspacing="0" cellpadding="0"><TR><td valign="top"><a href="21021536.html"><img src="images/pixel.jpg" alt="" width="1" height="1" border="0"></a><a name="ch05lev1sec3"></a>

<h3 id="title-IDACDBZV" class="docSection1Title">Integrating Custom Widgets with Qt Designer</h3>
<p class="docText"><a name="iddle2298"></a><a name="iddle2301"></a><a name="iddle2660"></a><a name="iddle2666"></a><a name="iddle2724"></a><a name="iddle2748"></a><a name="iddle3759"></a><a name="iddle3882"></a><a name="iddle5147"></a>Before we can use custom widgets in <span class="docEmphasis">Qt Designer</span>, we must make <span class="docEmphasis">Qt Designer</span> aware of them. There are two techniques for doing this: the &quot;promotion&quot; approach and the plugin approach.</p>
<p class="docText">The promotion approach is the quickest and easiest. It consists of choosing a built-in Qt widget that has a similar API to the one we want our custom widget to have and completing a dialog box in <span class="docEmphasis">Qt Designer</span> with some information about the custom widget. The widget can then be used in forms developed with <span class="docEmphasis">Qt Designer</span>, although it will be represented by the associated built-in Qt widget while the form is edited or previewed.</p>
<p class="docText">Here's how to insert a <tt>HexSpinBox</tt> widget into a form using this approach:</p>
<div style="font-weight:bold"><ol class="docList" type="1"><li><div style="font-weight:normal"><p class="docList">Create a <tt>QSpinBox</tt> by dragging it from <span class="docEmphasis">Qt Designer</span>'s widget box onto the form.</p></div></li><li><div style="font-weight:normal"><p class="docList">Right-click the spin box and choose Promote to Custom Widget from the context menu.</p></div></li><li><div style="font-weight:normal"><p class="docList">Fill in the dialog that pops up with &quot;HexSpinBox&quot; as the class name and &quot;hexspinbox.h&quot; as the header file.</p></div></LI></ol></div>
<p class="docText">Voil&agrave;! The code generated by <tt>uic</tt> will include <tt>hexspinbox.h</tt> instead of <tt>&lt;QSpinBox&gt;</tt> and instantiate a <tt>HexSpinBox</tt>. In <span class="docEmphasis">Qt Designer</span>, the <tt>HexSpinBox</tt> widget will be represented by a <tt>QSpinBox</tt>, allowing us to set all the properties of a <tt>QSpinBox</tt> (for example, the range and the current value).</P>
<a name="ch05fig06"></a><P><center>

<H5 class="docFigureTitle">Figure 5.6. <span class="docEmphasis">Qt Designer</span>'s custom widget dialog</H5>

<p class="docText">
<img border="0" alt="" width="417" height="196" SRC="images/qtdesignercustom.jpg"></p>

</center></p><br>
<p class="docText">The drawbacks of the promotion approach are that properties that are specific to the custom widget aren't accessible in <span class="docEmphasis">Qt Designer</span> and that the widget isn't rendered as itself. Both these problems can be solved by using the plugin approach.</p>
<p class="docText">The plugin approach requires the creation of a plugin library that <span class="docEmphasis">Qt Designer</span> can load at run-time and use to create instances of the widget. The real widget is then used by <span class="docEmphasis">Qt Designer</span> when editing the form and for previewing, and thanks to Qt's meta-object system,<span class="docEmphasis">Qt Designer</span> can dynamically obtain the list of its properties. To show how this works, we will integrate the <tt>IconEditor</tt> from the previous section as a plugin.</p>
<p class="docText"><a name="iddle2737"></a><a name="iddle2738"></a><a name="iddle2739"></a><a name="iddle2743"></a><a name="iddle2745"></a><a name="iddle2816"></a><a name="iddle3313"></a><a name="iddle3364"></a><a name="iddle3468"></a><a name="iddle3923"></a><a name="iddle4180"></a><a name="iddle4184"></a><a name="iddle4186"></a><a name="iddle6623"></a><a name="iddle7000"></a><a name="iddle7067"></a>First, we must subclass <tt>QDesignerCustomWidgetInterface</tt> and reimplement some virtual functions. We will assume that the plugin source code is located in a directory called <tt>iconeditorplugin</tt> and that the <tt>IconEditor</tt> source code is located in a parallel directory called <tt>iconeditor</tt>.</p>
<p class="docText">Here's the class definition:</p>
<div class="docText"><pre>
#include &lt;QDesignerCustomWidgetInterface&gt;
class IconEditorPlugin : public QObject,
                         public QDesignerCustomWidgetInterface
{
    Q_OBJECT
    Q_INTERFACES(QDesignerCustomWidgetInterface)
public:
    IconEditorPlugin(QObject *parent = 0);
    QString name() const;
    QString includeFile() const;
    QString group() const;
    QIcon icon() const;
    QString toolTip() const;
    QString whatsThis() const;
    bool isContainer() const;
    QWidget *createWidget(QWidget *parent);
};
</pre></div><br>
<p class="docText">The <tt>IconEditorPlugin</tt> subclass is a factory class that encapsulates the <tt>IconEditor</tt> widget. It inherits both <tt>QObject</tt> and <tt>QDesignerCustomWidgetIterface</tt> and uses the <tt>Q_INTERFACES()</tt> macro to tell <tt>moc</tt> that the second base class is a plugin interface. The functions are used by <span class="docEmphasis">Qt Designer</span> to create instances of the class and to obtain information about it.</p>
<div class="docText"><pre>
IconEditorPlugin::IconEditorPlugin(QObject *parent)
    : QObject(parent)
{
}
</pre></div><br>
<p class="docText">The constructor is trivial.</p>
<div class="docText"><pre>
QString IconEditorPlugin::name() const
{
    return "IconEditor";
}
</pre></div><br>
<p class="docText">The <tt>name()</tt> function returns the name of the widget provided by the plugin.</P>
<div class="docText"><pre>
QString IconEditorPlugin::includeFile() const
{
    return "iconeditor.h";
}
</pre></div><br>
<p class="docText">The <tt>includeFile()</tt> function returns the name of the header file for the specified widget encapsulated by the plugin. The header file is included in the code generated by the <tt>uic</tt> tool.</p>
<div class="docText"><pre>
QString IconEditorPlugin::group() const
{
    return tr("Image Manipulation Widgets");
}
</pre></div><BR>
<p class="docText"><a name="iddle1304"></a><a name="iddle1725"></a><a name="iddle2364"></a><a name="iddle2599"></a><a name="iddle2721"></a><a name="iddle2740"></a><a name="iddle2741"></a><a name="iddle2742"></a><a name="iddle2744"></a><a name="iddle2746"></a><a name="iddle2747"></a><a name="iddle2912"></a><a name="iddle3920"></a><a name="iddle4181"></a><a name="iddle4182"></a><a name="iddle4183"></a><a name="iddle4185"></a><a name="iddle4187"></a><a name="iddle4188"></a><a name="iddle4386"></a><a name="iddle6880"></a><a name="iddle6881"></a><a name="iddle7200"></a><a name="iddle7201"></a>The <tt>group()</tt> function returns the name of the widget box group this custom widget should belong to. If the name isn't already in use,<span class="docEmphasis">Qt Designer</span> will create a new group for the widget.</P>
<div class="docText"><pre>
QIcon IconEditorPlugin::icon() const
{
    return QIcon(":/images/iconeditor.png");
}
</pre></div><br>
<p class="docText">The <tt>icon()</tt> function returns the icon to use to represent the custom widget in <span class="docEmphasis">Qt Designer</span>'s widget box. Here, we assume that the <tt>IconEditorPlugin</tt> has an associated Qt resource file with a suitable entry for the icon editor image.</p>
<div class="docText"><pre>
QString IconEditorPlugin::toolTip() const
{
    return tr("An icon editor widget");
}
</pre></div><br>
<p class="docText">The <tt>toolTip()</tt> function returns the tooltip to show when the mouse hovers over the custom widget in <span class="docEmphasis">Qt Designer</span>'s widget box.</p>
<div class="docText"><pre>
QString IconEditorPlugin::whatsThis() const
{
    return tr("This widget is presented in Chapter 5 of &lt;i&gt;C++ GUI "
              "Programming with Qt 4&lt;/i&gt; as an example of a custom Qt "
              "widget.");
}
</pre></div><BR>
<p class="docText">The <tt>whatsThis()</tt> function returns the &quot;What's This?&quot; text for <span class="docEmphasis">Qt Designer</span> to display.</p>
<div class="docText"><pre>
bool IconEditorPlugin::isContainer() const
{
    return false;
}
</pre></div><br>
<p class="docText">The <tt>isContainer()</tt> function returns <tt>true</tt> if the widget can contain other widgets; otherwise, it returns <tt>false</tt>. For example, <tt>QFrame</tt> is a widget that can contain other widgets. In general, any Qt widget can contain other widgets, but <span class="docEmphasis">Qt Designer</span> disallows this when <tt>isContainer()</tt> returns <tt>false</tt>.</p>
<div class="docText"><pre>
QWidget *IconEditorPlugin::createWidget(QWidget *parent)
{
    return new IconEditor(parent);
}
</pre></div><BR>
<p class="docText">The <tt>create()</tt> function is called by <span class="docEmphasis">Qt Designer</span> to create an instance of a widget class with the given parent.</P>
<div class="docText"><pre>
Q_EXPORT_PLUGIN2(iconeditorplugin, IconEditorPlugin)
</pre></div><BR>
<p class="docText"><a name="iddle2165"></a><a name="iddle2309"></a><a name="iddle3754"></a><a name="iddle3849"></a><a name="iddle5254"></a><a name="iddle5896"></a>At the end of the source file that implements the plugin class, we must use the <tt>Q_EXPORT_PLUGIN2()</tt> macro to make the plugin available to <span class="docEmphasis">Qt Designer</span>. The first argument is the name we want to give the plugin; the second argument is the name of the class that implements it.</p>
<p class="docText">The <tt>.pro</tt> file for building the plugin looks like this:</p>
<div class="docText"><pre>
TEMPLATE        = lib
CONFIG         += designer plugin release
HEADERS         = ../iconeditor/iconeditor.h \
                  iconeditorplugin.h
SOURCES         = ../iconeditor/iconeditor.cpp \
                  iconeditorplugin.cpp
RESOURCES       = iconeditorplugin.qrc
DESTDIR         = $(QTDIR)/plugins/designer
</pre></div><br>
<p class="docText">The <tt>.pro</tt> file assumes that the <tt>QtdIR</tt> environment variable is set to the directory where Qt is installed. When you type <tt>make</tt> or <tt>nmake</tt> to build the plugin, it will automatically install itself in <span class="docEmphasis">Qt Designer</span>'s <tt>plugins</tt> directory. Once the plugin is built, the <tt>IconEditor</tt> widget can be used in <span class="docEmphasis">Qt Designer</span> in the same way as any of Qt's built-in widgets.</p>
<p class="docText">If you want to integrate several custom widgets with <span class="docEmphasis">Qt Designer</span>, you can either create one plugin for each one of them or combine them into a single plugin by deriving from <tt>QDesignerCustomWidgetCollectionInterface</tt>.</p>

<a href="21021536.html"><img src="images/pixel.jpg" alt="" width="1" height="1" border="0"></a></TD></TR></table>
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch05lev1sec2.html><img src="images/prev.gif" width="60" height="17" border="0" align="absmiddle" alt="Previous Page"></a>
<td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch05lev1sec4.html><img src="images/next.gif" width="60" height="17" border="0" align="absmiddle" alt="Next Page"></a>
</div></td></tr></table>
<div style="display:none"><center><a href="http://sourceforge.net/donate/index.php?group_id=186258"><img src="http://images.sourceforge.net/images/project-support.jpg" width="88" height="32" border="0" alt="Support This Project" /> </a>|<script src='http://s34.cnzz.com/stat.php?id=626330&web_id=626330&show=pic2' language='JavaScript' charset='gb2312'></script></center></script></div></body></html>